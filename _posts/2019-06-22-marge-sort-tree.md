---
layout: post
title: Marge Sort Tree (MST)
author-id: HBKWasi
tags: [Data Structures]
---
<!-- This is also a comment in markdown -->

ржПржЗ ржЖрж░рзНржЯрж┐ржХрзЗрж▓ржЯрж┐ ржкрзЬрж╛рж░ ржкрзВрж░рзНржмрж╢рж░рзНржд: рж╕рзЗржЧржорзЗржирзНржЯ ржЯрзНрж░рж┐, ржорж╛рж░рзНржЬ рж╕рж░рзНржЯ ржПрж▓ржЧрзЛрж░рж┐ржжржо, ржмрж╛ржЗржирж╛рж░рзА рж╕рж╛рж░рзНржЪ рж╕ржорзНржкрж░рзНржХрзЗ ржзрж╛рж░ржгрж╛ ржерж╛ржХрждрзЗ рж╣ржмрзЗред ржирж╛ ржерж╛ржХрж▓рзЗ ржПржЗ рж▓рж┐ржВржХржЧрзБрж▓рзЛ ржерзЗржХрзЗ рж╢рж┐ржЦрзЗ ржирж╛ржУ:-

[рж╕рзЗржЧржорзЗржирзНржЯ ржЯрзНрж░рж┐](http://www.shafaetsplanet.com/?p=1557)

[ржорж╛рж░рзНржЬ рж╕рж░рзНржЯ](https://roomcharshotin.wordpress.com/2018/09/26/merge-sort-details/)

[ржмрж╛ржЗржирж╛рж░рзА рж╕рж╛рж░рзНржЪ](http://www.shafaetsplanet.com/?p=2279)

ржЯрж╛рж░рзНржЧрзЗржЯ ржкрзНрж░ржмрж▓рзЗржо: ржЖржорж╛ржжрзЗрж░ ржХрж╛ржЫрзЗ ржПржХржЯрж╛ ржЕрзНржпрж╛рж░рзЗ ржЖржЫрзЗред ржЖржорж╛ржжрзЗрж░ржХрзЗ ржХрж┐ржЫрзБ ржкрзНрж░рж╢рзНржи ржХрж░рж╛ рж╣ржмрзЗ ржЕрзНржпрж╛рж░рзЗржЯрж╛ рж╕ржорзНржкрж░рзНржХрзЗред ржЖржорж╛ржжрзЗрж░ рж╕рзЗ ржкрзНрж░рж╢рзНржиржЧрзБрж▓рзЛрж░ ржЙрждрзНрждрж░ ржжрж┐рждрзЗ рж╣ржмрзЗред ржкрзНрж░рж╢рзНржиржЧрзБрж▓рзЛ рзй ржЯрж┐ рж╕ржВржЦрзНржпрж╛ $$l$$, $$r$$ ржУ $$k$$ ржжрзЗржУрзЯрж╛ рж╣ржмрзЗред ржЖржорж╛ржжрзЗрж░ ржмрж▓рждрзЗ рж╣ржмрзЗ ржЕрзНржпрж╛рж░рзЗржЯрж┐рж░ $$l$$ ржерзЗржХрзЗ $$r$$ ржПрж░ ржоржзрзНржпрзЗ $$k$$ ржПрж░ ржЪрзЗрзЯрзЗ ржЫрзЛржЯ ржХрзЯржЯрж┐ рж╕ржВржЦрзНржпрж╛ ржЖржЫрзЗред

рж╕рж▓рж┐ржЙрж╢рж╛ржи: ржПржЯрж╛ рж╕рж▓ржн ржХрж░рж╛рж░ ржЬржирзНржп ржЖржорж╛ржжрзЗрж░ ржоржирзЗ ржкрзНрж░ржержорзЗ ржпрзЗ ржЙржкрж╛рзЯржЯрж╛ ржЖрж╕рждрзЗ ржкрж╛рж░рзЗ рж╕рзЗржЯрж╛ рж╣ржЪрзНржЫрзЗ ржкрзНрж░ржержорзЗ ржЖржорж░рж╛ ржПржХржЯрж╛ ржЖрж▓рж╛ржжрж╛ ржЕрзНржпрж╛рж░рзЗрждрзЗ ржПржЗ рж░рзЗржЮрзНржЬ ржПрж░ рж╕ржмржЧрзБрж▓рж╛ рж╕ржВржЦрзНржпрж╛ ржХржкрж┐ ржХрж░ржм, рждрж╛рж░ржкрж░ рж╕рж░рзНржЯ ржХрж░ржм, рждрж╛рж░ржкрж░ ржжрзЗржЦржм ржХрзЯржЯрж╛ рж╕ржВржЦрзНржпрж╛ k ржПрж░ ржЪрзЗрзЯрзЗ ржЫрзЛржЯред ржПржнрж╛ржмрзЗ ржЖржорж░рж╛ ржЪрж╛ржЗрж▓рзЗ ржмрзЗрж░ ржХрж░рждрзЗ ржкрж╛рж░ржмред рждржмрзЗ ржПрждрзЗ рж╕ржорж╕рзНржпрж╛ рж╣ржЪрзНржЫрзЗ ржЕржирзЗржХ рж╕ржорзЯ рж▓рж╛ржЧржмрзЗред ржкрзНрж░рждрж┐ржмрж╛рж░ рж╕рж░рзНржЯ ржХрж░рждрзЗ ржУрж░рж╕рзНржЯ ржХрзЗрж╕ ржП ржЯрж╛ржЗржо ржХржорзНржкрзНрж▓рзЗржХрзНрж╕рж┐ржЯрж┐  $$O(log(n))$$  рж╣ржмрзЗ ред рждрж╛ржЗ $$q$$  ржЯрж╛ ржХрзБрзЯрзЗрж░рж┐ рж╣рж▓рзЗ ржорзЛржЯ ржЯрж╛ржЗржо ржХржорзНржкрзНрж▓рзЗржХрзНрж╕рж┐ржЯрж┐ $$O(qnlog(n))$$ рж╣ржмрзЗред рждрж╛ржЗ ржПржЯрж╛ ржорзЛржЯрж╛ржорзБржЯрж┐ ржзрж░ржгрзЗрж░ ржмрзЬ $$q$$ ржПржмржВ $$n$$ ржПрж░ ржЬржирзНржпржУ ржЕржирзЗржХ рж╕ржорзЯ ржирж╖рзНржЯ ржХрж░ржмрзЗред ржПржЯрж╛ рж╣рж▓рзЗ рждрзЛ рж╣ржмрзЗ ржирж╛ред ржПржЯрж╛рж░ ржЯрж╛ржЗржо ржХржорзНржкрзНрж▓рзЗржХрзНрж╕рж┐ржЯрж┐ ржХржорж╛рждрзЗ рж╣ржмрзЗред ржПржЬржирзНржп ржЖржорж░рж╛ рж╕рзЗржЧржорзЗржирзНржЯ ржЯрзНрж░рж┐рж░ рж╕рж╛рж╣рж╛ржпрзНржп ржирж┐ржмред ржорзВрж▓ ржЖржЗржбрж┐рзЯрж╛ржЯрж╛ рж╣ржЪрзНржЫрзЗ рж╕рзЗржЧржорзЗржирзНржЯ ржЯрзНрж░рж┐рж░ ржкрзНрж░рждрж┐ржЯрж╛ ржирзЛржб ржП ржПржХржЯрж╛ рж╕ржВржЦрзНржпрж╛ рж╕рзЗржн ржирж╛ ржХрж░рзЗ, ржУржЗ рж░рзЗржЮрзНржЬ ржПрж░ рж╕ржмржЧрзБрж▓рзЛ рж╕ржВржЦрзНржпрж╛ рж╕рж░рзНржЯрзЗржб ржЖржХрж╛рж░рзЗ рж╕рзЗржн ржХрж░рзЗ рж░рж╛ржЦрж╛ рж╣ржмрзЗред  ржПржЯрж╛рж░ ржЬржирзНржп ржЖржорж░рж╛ ржорж╛рж░рзНржЬ рж╕рж░рзНржЯ ржПрж▓ржЧрзЛрж░рж┐ржжржо ржПрж░ рж╕рж╛рж╣рж╛ржпрзНржп ржирзЗржмред ржорж╛рж░рзНржЬ рж╕рж░рзНржЯ ржХрж░рж╛рж░ рж╕ржорзЯ ржЖржорж░рж╛ ржпрзЗржнрж╛ржмрзЗ ржЕрзНржпрж╛рж░рзЗржЯрж╛ржХрзЗ ржжрзБржЗ ржнрж╛ржЧрзЗ ржнрж╛ржЧ ржХрж░рзЗ ржлрзЗрж▓рж┐ ржПржмржВ ржнрж╛ржЧ ржХрж░рждрзЗржЗ ржерж╛ржХрж┐ ржпрждржХрзНрж╖ржг ржирж╛ ржПржХржЯрж╛ рж╕ржВржЦрзНржпрж╛рзЯ ржирзЗржорзЗ ржЖрж╕рзЗ, ржПржнрж╛ржмрзЗржЗ ржХрж┐ржирзНрждрзБ ржЖржорж░рж╛ рж╕рзЗржЧржорзЗржирзНржЯ ржЯрзНрж░рж┐ржУ ржмрж╛ржирж╛ржЗред рж╕рзЗржЧржорзЗржирзНржЯ ржЯрзНрж░рж┐ ржмрж╛ржирж╛ржирзЛрж░ рж╕ржорзЯржУ ржЖржорж░рж╛ рж░рзЗржЮрзНржЬржЯрж╛ржХрзЗ ржжрзБржЗ ржнрж╛ржЧрзЗ ржнрж╛ржЧ ржХрж░рзЗ ржлрзЗрж▓рж┐ ржПржмржВ ржпрждржХрзНрж╖ржг ржкрж░рзНржпржирзНржд ржирж╛ рж╢рзЗрж╖ржорзЗрж╢ ржПржХржЯрж╛ рж╕ржВржЦрзНржпрж╛рзЯ ржирзЗржорзЗ ржЖрж╕рзЗ рждрждржХрзНрж╖ржг ржкрж░рзНржпржирзНржд ржнрж╛ржЧ ржХрж░рждрзЗржЗ ржерж╛ржХрж┐ред рж╕рзЗржЧржорзЗржирзНржЯ ржЯрзНрж░рж┐ ржПржмржВ ржорж╛рж░рзНржЬ рж╕рж░рзНржЯ ржПрж░ ржЕрзНржпрж╛рж░рзЗ ржнрж╛ржЧ ржХрж░рж╛рж░ ржкржжрзНржзрждрж┐рждрзЗ ржЖржорж░рж╛ ржХрж┐ржирзНрждрзБ ржПржХржЯрж╛ ржорж┐рж▓ ржжрзЗржЦрждрзЗ ржкрж╛ржЪрзНржЫрж┐ред ржПржЗ ржорж┐рж▓ржЯрж╛ржХрзЗ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржЖржорж░рж╛ тАЬржорж╛рж░рзНржЬ рж╕рж░рзНржЯтАЭ ржПржмржВ тАЬрж╕рзЗржЧржорзЗржирзНржЯ ржЯрзНрж░рж┐тАЭ ржПрж░ ржорж╛рж░рзНржЬ ржХрж░рзЗ тАЬржорж╛рж░рзНржЬ рж╕рж░рзНржЯ ржЯрзНрж░рж┐тАЭ ржмрж╛ржирж╛ржмрзЛред ржПржЯрж╛ рж╣ржЪрзНржЫрзЗ ржПржХржЯрж╛ рж╕рзЗржЧржорзЗржирзНржЯ ржЯрзНрж░рж┐ ржпрж╛рж░ ржкрзНрж░рждрзНржпрзЗржХржЯрж╛ ржирзЛржбрзЗ ржУржЗ рж░рзЗржЮрзНржЬ ржП ржорж╛рж░рзНржЬ рж╕рж░рзНржЯ ржХрж░рж╛рж░ ржкрж░ ржпрзЗ рж╕рж░рзНржЯрзЗржб ржЕрзНржпрж╛рж░рзЗржЯрж╛ рждрзИрж░рж┐ рж╣рзЯрзЗржЫрзЗ рж╕рзЗржЯрж╛ ржерж╛ржХржмрзЗред ржПржЯрж╛ржХрзЗржЗ ржорж╛рж░рзНржЬ рж╕рж░рзНржЯ ржЯрзНрж░рж┐ ржмрж▓рж╛ рж╣рзЯред ржЦрзБржмржЗ ржмрзЗрж╕рж┐ржХ ржзрж╛рж░ржгрж╛ред ржорж╛рж░рзНржЬ рж╕рж░рзНржЯ ржПржмржВ рж╕рзЗржЧржорзЗржирзНржЯ ржЯрзНрж░рж┐ ржЙржнрзЯржЯрж╛ ржЬрж╛ржирж╛ ржерж╛ржХрж▓рзЗ ржорж╛рж░рзНржЬ рж╕рж░рзНржЯ ржЯрзНрж░рж┐ ржмрзБржЭрж╛ ржХрзЛржирзЛ ржмрзНржпрж╛ржкрж╛рж░ ржЗ ржирж╛ред ЁЯЩВ

ржЗржоржкрзНрж▓рж┐ржорзЗржирзНржЯрзЗрж╢ржи: ржЗржоржкрзНрж▓рж┐ржорзЗржирзНржЯрзЗрж╢ржирзЗрж░ ржЬржирзНржп ржЖржорж░рж╛ ржкрзНрж░ржержорзЗ ржПржХржЯрж┐ рзиржбрж┐ ржнрзЗржХрзНржЯрж░ ржирж┐ржмред ржмрж┐рж▓рзНржб ржлрж╛ржВрж╢рж╛ржиржЯрж╛ рж╕рж╛ржзрж╛рж░ржг рж╕рзЗржЧржорзЗржирзНржЯ ржЯрзНрж░рж┐рж░ ржмрж┐рж▓рзНржб ржлрж╛ржВрж╢рж╛ржи ржПрж░ ржорждрзЛржЗ рж╣ржмрзЗред рж╢рзБржзрзБ рж░рзЗржЮрзНржЬ ржПржХржЯрж┐ рж╕ржВржЦрзНржпрж╛рзЯ ржирзЗржорзЗ ржЖрж╕рж▓рзЗ ржЖржорж░рж╛ ржнрзЗржХрзНржЯрж░рзЗ ржнрзНржпрж╛рж▓рзБ ржПрж╕рж╛ржЗржи ржирж╛ ржХрж░рзЗ ржкрзБрж╢ ржХрж░рзЗ ржжрж┐ржмред ржЖрж░ рж╢рзЗрж╖ рж▓рж╛ржЗржирзЗ ржкрзНржпрж╛рж░рзЗржирзНржЯ ржПрж░ ржнрзЗржХрзНржЯрж░ рждрзИрж░рж┐ ржХрж░рж╛рж░ ржЬржирзНржп $$marge()$$ ржлрж╛ржВрж╢ржиржЯрж┐ ржмрзНржпржмрж╣рж╛рж░ ржХрж░ржмред ржПржЯрж╛рж░ ржХрж╛ржЬ рждрзЛржорж░рж╛ ржорж╛рж░рзНржЬ рж╕рж░рзНржЯ ржПрж▓ржЧрзЛрж░рж┐ржжржо рж╢рж┐ржЦрж╛рж░ рж╕ржорзЯржЗ ржЬрзЗржирзЗ ржПрж╕рзЗржЫред ЁЯЩВ рждрж╛рж╣рж▓рзЗржЗ ржмрж┐рж▓рзНржб ржлрж╛ржВрж╢рж╛ржирзЗрж░ ржХрж╛ржЬ рж╢рзЗрж╖ред ржПржмрж╛рж░ ржЖрж╕рзЗ ржЖржорж░рж╛ ржХрзБрзЯрзЗрж░рж┐ ржХрж┐ржнрж╛ржмрзЗ ржХрж░ржмред ржХрзБрзЯрзЗрж░рж┐ ржХрж░рж╛рж░ ржЬржирзНржп ржЖржорж░рж╛ рж╕рж╛ржзрж╛рж░ржг ржХрзБрзЯрзЗрж░рж┐рж░ ржорждрзЛ рж░рзЗржЮрзНржЬржЯрж╛ржХрзЗ рзи ржПрж░ ржкрж╛ржУрзЯрж╛рж░рзЗрж░ ржЕржирзЗржХржЧрзБрж▓рж╛ рж░рзЗржЮрзНржЬ ржП ржнрзЗржЩрзНржЧрзЗ ржлрзЗрж▓ржмред ржП рж░рзЗржЮрзНржЬ ржПрж░ ржкрзНрж░рждрзНржпрзЗржХржЯрж╛ ржирзЛржбрзЗрж░ ржнрзЗржХрзНржЯрж░ржЗ ржХрж┐ржирзНрждрзБ ржЖржЧрзЗ ржерзЗржХрзЗ рж╕рж░рзНржЯрзЗржбред рждрж╛ржЗ ржЖржорж░рж╛ ржмрж╛ржЗржирж╛рж░рзА рж╕рж╛рж░рзНржЪ ржХрж░рзЗ ржкрзНрж░ржержо рж╕ржВржЦрзНржпрж╛ржЯрж╛ ржмрзЗрж░ ржХрж░ржм ржпрзЗржЯрж╛ ржХрзБрзЯрзЗрж░рж┐рждрзЗ ржкрзНрж░ржжрждрзНржд рж╕ржВржЦрзНржпрж╛ржЯрж╛рж░ ржЪрзЗрзЯрзЗ ржмрзЬред ржПржЯрж╛рж░ ржЖржЧрзЗрж░ рж╕ржмржЧрзБрж▓рж╛ рж╕ржВржЦрзНржпрж╛рж░ рж╕ржВржЦрзНржпрж╛ржЗ рж╣ржмрзЗ ржЖржорж╛ржжрзЗрж░ ржХрж╛ржЩрзНржХрзНрж╖рж┐рждред ржПржмрж╛рж░ ржЖржорж░рж╛ рж╕ржмржЧрзБрж▓рж╛ рж░рзЗржЮрзНржЬ ржПрж░ ржЬржирзНржп ржПржЗ тАЬрж╕ржВржЦрзНржпрж╛ржЧрзБрж▓рзЛрж░ рж╕ржВржЦрзНржпрж╛рж░тАЭ (ржорж╛ржирзЗ ржХрзЯржЯрж╛ рж╕ржВржЦрзНржпрж╛ ржЖржЫрзЗ ржПржоржи)  ржпрзЛржЧржлрж▓ ржмрзЗрж░ ржХрж░рзЗ ржлрзЗрж▓ржмред рждрж╛рж╣рж▓рзЗ ржПржЯрж╛ржЗ рж╣ржмрзЗ ржЖржорж╛ржжрзЗрж░ ржХрж╛ржЩрзНржХрзНрж╖рж┐ржд ржЙрждрзНрждрж░ред

ржирж┐ржЪрзЗ ржПржЯрж╛рж░ рж╕рж┐++ ржПрж░ ржХрзЛржб ржжрзЗрзЯрж╛ рж╣рж▓:

ржмрж┐рж▓рзНржб ржлрж╛ржВрж╢ржи:
```cpp
vector<int>tree[4*N];
int A[N];
void build_tree( int cur , int l , int r )
{
     if( l==r )
     {
            tree[cur].push_back( a[ l ] );
            return ;
     }
     int mid = (l+r)/2;
     build_tree(2*cur, l , mid ); // Build left tree 
     build_tree(2*cur+1 , mid+1 , r ); // Build right tree
     tree[cur] = merge( tree[2*cur] , tree[2*cur+1] ); //Merging the two sorted arrays
}
```
ржХрзБрзЯрзЗрж░рж┐ ржлрж╛ржВрж╢ржи:
```cpp
int query( int cur, int l, int r, int x, int y, int k)
{
      if( r < x || l > y )
      {
           return 0; //out of range
      }
      if( x<=l && r<=y )
      {
            //Binary search over the current sorted vector to find elements smaller than K
            return upper_bound(tree[cur].begin(),tree[cur].end(),K)-tree[cur].begin();
      }
      int mid=(l+r)/2;
      return query(2*cur,l,mid,x,y,k)+query(2*cur+1,mid+1,r,x,y,k);
}
```
ржХржорзНржкрзНрж▓рзЗржХрзНрж╕рж┐ржЯрж┐ ржПржирж╛рж▓рж╛ржЗрж╕рж┐рж╕:

ржмрж┐рж▓рзНржб ржХрж░рж╛рж░ ржЯрж╛ржЗржо ржХржорзНржкрзНрж▓рзЗржХрзНрж╕рж┐ржЯрж┐ рж╣ржмрзЗ $$O(nlogn)$$ред ржПржЯрж╛ ржЖржорж░рж╛ рж╕рж╣ржЬрзЗржЗ ржЕржирзБржзрж╛ржмржи ржХрж░рждрзЗ ржкрж╛рж░рж┐ред ржПржЦржи ржЖрж╕рж▓ ржкрзНрж░рж╢рзНржи рж╣ржЪрзНржЫрзЗ ржорзЗржорзЛрж░рж┐ ржХржорзНржкрзНрж▓рзЗржХрзНрж╕рж┐ржЯрж┐ ржХржд рж╣ржмрзЗред ржЖржорж░рж╛ ржПржХржЯрзБ ржнрж╛ржмрж▓рзЗржЗ ржмрзБржЭрждрзЗ ржкрж╛рж░ржмрзЛ ржпрзЗ ржорзЗржорзЛрж░рж┐ ржХржорзНржкрзНрж▓рзЗржХрзНрж╕рж┐ржЯрж┐ржУ $$O(nlogn)$$ рж╣ржмрзЗред ржХрж╛рж░ржг ржПржХржЯрж╛ рж╕ржВржЦрзНржпрж╛ рж╕рж░рзНржмрзЛржЪрзНржЪ $$logn$$ рж╕ржВржЦрзНржпрж╛ржХ ржмрж╛рж░ ржЯрзНрж░рж┐ рждрзЗ ржерж╛ржХрждрзЗ ржкрж╛рж░рзЗ (ржЯрзНрж░рж┐ ржПрж░ рж╣рж╛ржЗржЯ)ред

ржХрзБрзЯрзЗрж░рж┐ ржлрж╛ржВрж╢рж╛ржирзЗрж░ ржХржорзНржкрзНрж▓рзЗржХрзНрж╕рж┐ржЯрж┐ $$O(log^{2} n)$$ рж╣ржмрзЗред ржХрж╛рж░ржг ржПржХржЯрж╛ рж░рзЗржЮрзНржЬ ржХрзЗ рж╕рж░рзНржмрзЛржЪрзНржЪ $$logn$$ ржЯрж╛ ржнрж╛ржЧрзЗ ржнрж╛ржЧ ржХрж░рж╛ ржпрж╛рзЯред ржЖрж░ ржкрзНрж░рждрж┐ржЯрж╛ рж░рзЗржЮрзНржЬ ржПрж░ ржЬржирзНржп ржПржХржмрж╛рж░ ржХрж░рзЗ ржмрж╛ржЗржирж╛рж░рзА рж╕рж╛рж░рзНржЪ ржХрж░рж╛ рж▓рж╛ржЧржмрзЗ, ржпрж╛рж░ ржХржорзНржкрзНрж▓рзЗржХрзНрж╕рж┐ржЯрж┐ $$logn$$ред рждрж╛ржЗ ржорзЛржЯ ржХржорзНржкрзНрж▓рзЗржХрзНрж╕рж┐ржЯрж┐ рж╣ржмрзЗ $$O(log^{2} n)$$ ЁЯЩВ

ржкрзНрж░рзНржпрж╛ржХржЯрж┐рж╕ ржкрзНрж░ржмрж▓рзЗржорж╕: 

[Anton and Permutation](http://codeforces.com/contest/785/problem/E)
[KQUERYO](https://www.spoj.com/problems/KQUERYO/)
ржПрж░ ржорж╛ржзрзНржпржорзЗржЗ ржЖржорж╛рж░ ржорж╛рж░рзНржЬ рж╕рж░рзНржЯ ржЯрзНрж░рж┐ ржирж┐рзЯрзЗ ржмрж┐рж░ржХрзНрждрж┐ржХрж░ ржХрзНржпрж╛ржЪржХрзНржпрж╛ржЪрж╛ржирж┐ рж╢рзЗрж╖ рж╣рж▓ред  ЁЯЩВ